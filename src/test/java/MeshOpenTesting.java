import Engine.Graphics.Mesh.Mesh;
import Engine.Graphics.Shaders.ShaderProgram;
import System.FileManagers.MeshFileManager;
import System.FileManagers.ShaderFileManager;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;

import java.io.File;

import static org.lwjgl.glfw.GLFW.*;

public class MeshOpenTesting {


    @BeforeAll
    static void start()
    {





    }

    @Test
    void completeTest()
    {
        long window = isolateProgramHelper.setUpGenericWindow();

        File file = MeshFileManager.getInstance().getModelFromResources("chess.obj");

        Mesh myMesh = Mesh.loadMesh(file);

        File v = ShaderFileManager.getInstance().getVertexShader("basicvert.glsl");
        File f = ShaderFileManager.getInstance().getFragShader("basicfrag.glsl");

        ShaderProgram shaderProgram = new ShaderProgram(v, f);

        shaderProgram.use();

        float[] mat = new float[16];
        mat[0] = 0.2f;
        mat[5] = 0.2f;
        mat[11] = 0.2f;
        mat[15] = 1.0f;


        shaderProgram.setUniform("modelMatrix", mat);
        shaderProgram.setUniform3f("location", myMesh.getPosition());



        myMesh.render();



        int error = glfwGetError(null);
        Assertions.assertEquals(GLFW_NO_ERROR, error, "GLFW encountered an error.");

        shaderProgram.stop();

        glfwSwapBuffers(window);

        int saveID = isolateProgramHelper.renderToTexture(myMesh, shaderProgram, 800, 800);

        isolateProgramHelper.saveTextureToFile(saveID, "saver.png");

        isolateProgramHelper.closeGenericWindow(window);


        System.out.println("completes");
    }
}
